<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sparta-pe</title>
    <link rel="manifest" href="manifest.json">
    <style>
        /* Estilos anteriores permanecem os mesmos */
    </style>
</head>
<body>
    <div id="app">
        <!-- Estrutura HTML anterior permanece a mesma -->
    </div>

    <script>
        const maxScore = 21;
        let whiteFouls = 0;
        let blueFouls = 0;
        let volume = 1; // Volume padrão (100%)

        // Função para falar texto
        function speak(text) {
            if (!window.speechSynthesis) {
                console.error("API de síntese de fala não suportada neste navegador.");
                return;
            }
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.volume = volume; // Ajusta o volume
            window.speechSynthesis.speak(utterance);
        }

        // Função para tocar a buzina
        function playBuzina() {
            const buzina = new Audio('buzina.mp3'); // Certifique-se de que o caminho está correto
            buzina.volume = volume; // Ajusta o volume conforme o controle
            buzina.play().catch(error => {
                console.error("Erro ao reproduzir a buzina:", error);
            });
        }

        // Função para ajustar a pontuação
        async function adjustScore(team, delta, playSound) {
            const scoreElement = document.getElementById(`${team}-score`);
            if (!scoreElement) {
                console.error(`Elemento de pontuação para ${team} não encontrado!`);
                return;
            }

            let currentScore = parseInt(scoreElement.textContent, 10);
            let newScore = currentScore + delta;

            if (newScore >= 0 && newScore <= maxScore) {
                scoreElement.textContent = newScore;

                if (playSound && newScore < maxScore) {
                    speak(`${team === 'white' ? 'Branco' : 'Azul'} ${newScore}`);
                }
            }

            // Emitir som ao atingir ou ultrapassar 21 pontos
            if (newScore >= maxScore && delta > 0) {
                speak(`A equipe ${team === 'white' ? 'Branco' : 'Azul'} atingiu 21 pontos!`);
            }
        }

        // Função para ajustar as faltas
        function adjustFouls(team, delta) {
            if (team === 'white') {
                whiteFouls = Math.max(0, whiteFouls + delta);
                const foulElement = document.getElementById('white-foul');
                if (foulElement) {
                    foulElement.textContent = whiteFouls;
                }
                if (whiteFouls >= 5) {
                    speak("Branco faltas estouradas!");
                } else {
                    speak(`Falta ${whiteFouls} Branco`);
                }
            } else if (team === 'blue') {
                blueFouls = Math.max(0, blueFouls + delta);
                const foulElement = document.getElementById('blue-foul');
                if (foulElement) {
                    foulElement.textContent = blueFouls;
                }
                if (blueFouls >= 5) {
                    speak("Azul faltas estouradas!");
                } else {
                    speak(`Falta ${blueFouls} Azul`);
                }
            }
        }

        // Variáveis Globais
        let gameTimerInterval;
        let shotClockInterval;
        let gameTime = 12 * 60; // 12 minutos em segundos
        let shotClockTime = 24;
        let isGameRunning = false;
        let isShotClockRunning = false;
        let isFullscreen = false;

        // Elementos HTML
        const gameTimeDisplay = document.getElementById('game-time-display');
        const shotClockDisplay = document.getElementById('shot-clock-display');
        const startPauseGameButton = document.getElementById('start-pause-game');
        const timeRequestButton = document.getElementById('time-request');
        const fullscreenButton = document.getElementById('fullscreen-button');
        const volumeControl = document.getElementById('volume');

        // Verificação de elementos críticos
        if (!gameTimeDisplay || !shotClockDisplay || !startPauseGameButton || !timeRequestButton || !fullscreenButton || !volumeControl) {
            console.error("Um ou mais elementos críticos não foram encontrados no DOM!");
        }

        // Função para formatar o tempo em minutos e segundos
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Atualiza a exibição do cronômetro do jogo
        function updateGameTimer() {
            if (gameTimeDisplay) {
                gameTimeDisplay.textContent = formatTime(gameTime);
            }
        }

        // Atualiza a exibição do cronômetro do shot clock
        function updateShotClock() {
            if (shotClockDisplay) {
                shotClockDisplay.textContent = shotClockTime;
            }
        }

        // Inicia o cronômetro do jogo
        function startGameTimer() {
            if (isGameRunning) return;
            isGameRunning = true;
            if (startPauseGameButton) {
                startPauseGameButton.textContent = "Pausar Jogo";
            }
            gameTimerInterval = setInterval(() => {
                gameTime--;
                updateGameTimer();

                // Para o cronômetro quando o tempo acaba
                if (gameTime <= 0) {
                    clearInterval(gameTimerInterval);
                    clearInterval(shotClockInterval);
                    isGameRunning = false;
                    isShotClockRunning = false;
                    playBuzina();
                    speak("O tempo acabou!");
                }
            }, 1000);
        }

        // Inicia ou continua o shot clock
        function startShotClock(reset = false) {
            if (isShotClockRunning && !reset) return;
            isShotClockRunning = true;
            shotClockInterval = setInterval(() => {
                shotClockTime--;
                updateShotClock();

                // Sons de aviso
                if (shotClockTime === 10 || shotClockTime === 5) {
                    speak(shotClockTime.toString());
                }

                if (shotClockTime <= 0) {
                    // Reseta para 24 e continua a contagem
                    shotClockTime = 24;
                    updateShotClock();
                    playBuzina(); // Toca a buzina quando o tempo chega a zero
                    speak("Shot clock reiniciado para 24 segundos");
                }
            }, 1000);
        }

        // Alterna a execução do cronômetro do jogo
        function toggleGameTimer() {
            if (isGameRunning) {
                if (gameTimerInterval) clearInterval(gameTimerInterval);
                if (shotClockInterval) clearInterval(shotClockInterval);
                isGameRunning = false;
                isShotClockRunning = false;
                if (startPauseGameButton) {
                    startPauseGameButton.textContent = "Iniciar Jogo";
                }
            } else {
                startGameTimer();
                startShotClock();
            }
        }

        // Reseta o cronômetro do jogo e do shot clock
        function resetAll() {
            if (gameTimerInterval) clearInterval(gameTimerInterval);
            if (shotClockInterval) clearInterval(shotClockInterval);
            gameTime = 12 * 60;
            shotClockTime = 24;
            updateGameTimer();
            updateShotClock();
            isGameRunning = false;
            isShotClockRunning = false;
            if (startPauseGameButton) {
                startPauseGameButton.textContent = "Iniciar Jogo";
            }
            document.getElementById('blue-score').textContent = "0";
            document.getElementById('white-score').textContent = "0";
            whiteFouls = 0;
            blueFouls = 0;
            document.getElementById('white-foul').textContent = "0";
            document.getElementById('blue-foul').textContent = "0";
            speak("O jogo foi resetado.");
        }

        // Reseta o shot clock para 24 segundos e continua a contagem
        function resetShotClockTo24() {
            if (shotClockInterval) clearInterval(shotClockInterval);
            shotClockTime = 24;
            updateShotClock();
            startShotClock(true);
        }

        // Reseta o shot clock para 14 segundos e continua a contagem
        function resetShotClockTo14() {
            if (shotClockInterval) clearInterval(shotClockInterval);
            shotClockTime = 14;
            updateShotClock();
            startShotClock(true);
        }

        // Controle do botão de reset geral
        document.getElementById('reset-game')?.addEventListener('click', resetAll);

        // Controle dos botões de ajuste de tempo do jogo
        document.getElementById('game-time-increase')?.addEventListener('click', () => {
            gameTime += 10;
            updateGameTimer();
        });

        document.getElementById('game-time-decrease')?.addEventListener('click', () => {
            gameTime = Math.max(0, gameTime - 10);
            updateGameTimer();
        });

        // Controle dos botões de ajuste do shot clock
        document.getElementById('shot-clock-increase')?.addEventListener('click', () => {
            shotClockTime = Math.min(99, shotClockTime + 1);
            updateShotClock();
        });

        document.getElementById('shot-clock-decrease')?.addEventListener('click', () => {
            shotClockTime = Math.max(0, shotClockTime - 1);
            updateShotClock();
        });

        // Controle dos botões de reset do shot clock
        document.getElementById('reset-24')?.addEventListener('click', resetShotClockTo24);
        document.getElementById('reset-14')?.addEventListener('click', resetShotClockTo14);

        // Controle de som para o pedido de tempo
        timeRequestButton?.addEventListener('click', () => {
            speak("Pedido de tempo solicitado.");
        });

        // Controle do botão de fullscreen
        fullscreenButton?.addEventListener('click', () => {
            if (!document.documentElement.requestFullscreen) {
                console.error("API de tela cheia não suportada neste navegador.");
                return;
            }
            if (!isFullscreen) {
                document.documentElement.requestFullscreen();
                fullscreenButton.textContent = "Sair da Tela Cheia";
                isFullscreen = true;
            } else {
                document.exitFullscreen();
                fullscreenButton.textContent = "Tela Cheia";
                isFullscreen = false;
            }
        });

        // Adiciona event listeners para os novos botões de função
        document.getElementById('f1-button')?.addEventListener('click', () => {
            speak("Falta 1");
        });

        document.getElementById('f2-button')?.addEventListener('click', () => {
            speak("Falta 2");
        });

        document.getElementById('f3-button')?.addEventListener('click', () => {
            speak("Falta 3");
        });

        document.getElementById('f4-button')?.addEventListener('click', () => {
            speak("Falta 4");
        });

        document.getElementById('f5-button')?.addEventListener('click', () => {
            speak("Fora do jogo");
        });

        // Controle de Volume
        volumeControl?.addEventListener('input', (e) => {
            volume = parseFloat(e.target.value); // Atualiza o volume global
        });

        // Inicializa o cronômetro do jogo e do shot clock
        updateGameTimer();
        updateShotClock();

        // Adiciona o evento de clique ao botão de iniciar jogo
        startPauseGameButton?.addEventListener('click', toggleGameTimer);

        // Sugestão de instalação do aplicativo
        let deferredPrompt;

        if ('onbeforeinstallprompt' in window) {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                const installButton = document.createElement('button');
                installButton.innerText = 'Instalar App';
                document.body.appendChild(installButton);

                installButton.addEventListener('click', () => {
                    installButton.style.display = 'none';
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('Usuário aceitou a instalação do app');
                        } else {
                            console.log('Usuário rejeitou a instalação do app');
                        }
                        deferredPrompt = null;
                    });
                });
            });
        } else {
            console.log("Evento 'beforeinstallprompt' não suportado.");
        }

        // Registrar o Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registrado com sucesso:', registration);
                    })
                    .catch(error => {
                        console.log('Falha ao registrar o Service Worker:', error);
                    });
            });
        } else {
            console.log("Service Worker não suportado neste navegador.");
        }
    </script>
</body>
</html>